<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storing Token</title>
</head>
<body>
    <script>
        // Extraire les paramètres de l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        const photo = urlParams.get('photo');
        const role = urlParams.get('role');
        const id = urlParams.get('id');
        const name = urlParams.get('name');

        // Stocker le token dans localStorage sous MA_CLEE_SECRETE
        if (token) {
            localStorage.setItem('MA_CLEE_SECRETE', token);
            console.log('Token stocké dans localStorage sous MA_CLEE_SECRETE:', token);
        } else {
            console.error('Aucun token trouvé dans l’URL');
        }

        // Stocker la photo si présente
        if (photo) {
            localStorage.setItem('photo', photo);
            console.log('Photo stockée dans localStorage:', photo);
        }

        // Rediriger vers la page du dashboard
        if (role && id && name) {
            const dashboardUrl = `/${role}/dashboard/${id}/${name}`;
            console.log('Redirection vers:', dashboardUrl);
            window.location.href = dashboardUrl;
        } else {
            console.error('Paramètres manquants pour la redirection:', { role, id, name });
            window.location.href = '/login?error=' + encodeURIComponent('Erreur: Paramètres de redirection manquants');
        }
    </script>
</body>
</html>